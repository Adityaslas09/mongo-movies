<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoMovies | Your Movie Recommendation Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #0c0a09; background-image: radial-gradient(at 80% 20%, hsla(283, 74%, 18%, 0.4) 0px, transparent 50%), radial-gradient(at 20% 90%, hsla(210, 84%, 20%, 0.4) 0px, transparent 50%); }
        .movie-card { background: linear-gradient(135deg, rgba(255, 255, 255, 0.07), rgba(255, 255, 255, 0.02)); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative; overflow: hidden; }
        .movie-card:hover { transform: translateY(-8px) scale(1.03); box-shadow: 0 0 15px rgba(168, 85, 247, 0.4), 0 0 30px rgba(29, 78, 216, 0.3); border-color: rgba(168, 85, 247, 0.5); }
        .movie-card .movie-details { transition: opacity 0.3s ease, transform 0.3s ease; opacity: 0; transform: translateY(10px); background: linear-gradient(to top, rgba(0,0,0,0.95), transparent); backdrop-filter: blur(4px); }
        .movie-card:hover .movie-details { opacity: 1; transform: translateY(0); }
        .modal-backdrop { background-color: rgba(0,0,0,0.7); backdrop-filter: blur(8px); }
        .modal-content-container { background: rgba(17, 24, 39, 0.8); backdrop-filter: blur(20px); border: 1px solid transparent; position: relative; z-index: 1; }
        .modal-content-container::before { content: ''; position: absolute; top: 0; right: 0; bottom: 0; left: 0; z-index: -1; margin: -1px; border-radius: inherit; background: linear-gradient(to bottom right, #a855f7, #3b82f6); }
    </style>
</head>
<body class="text-gray-200">

    <div id="app" class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-5xl md:text-6xl font-extrabold text-white mb-2">MongoMovies</h1>
            <p class="text-lg text-gray-400">Your Universe of Film Awaits</p>
        </header>
        <div class="mb-10 max-w-2xl mx-auto">
            <div class="relative">
                <input type="text" id="search-input" placeholder="Search for movies, actors, genres..." class="w-full bg-gray-900/70 border-2 border-gray-700 text-white rounded-full py-3 px-6 focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
        </div>
        <main>
            <h2 class="text-2xl font-semibold text-white mb-6" id="grid-title">Top Rated Movies</h2>
            <div id="loader" class="text-center py-10">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto"></div>
                <p class="mt-4 text-gray-400">Loading cinematic wonders...</p>
            </div>
            <div id="movie-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6 hidden"></div>
            <p id="no-results" class="text-center text-gray-400 py-10 hidden">No movies found in this dimension.</p>
        </main>
    </div>
    <div id="movie-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div id="modal-content" class="modal-content-container rounded-lg shadow-2xl w-full max-w-4xl flex flex-col md:flex-row overflow-hidden"></div>
    </div>

    <script>
        const movieGrid = document.getElementById('movie-grid');
        const searchInput = document.getElementById('search-input');
        const gridTitle = document.getElementById('grid-title');
        const noResults = document.getElementById('no-results');
        const loader = document.getElementById('loader');
        const modal = document.getElementById('movie-modal');
        const modalContent = document.getElementById('modal-content');

        const fetchMovies = async (query = '') => {
            loader.style.display = 'block';
            movieGrid.style.display = 'none';
            noResults.style.display = 'none';
            const apiUrl = `http://localhost:3000/api/movies?search=${encodeURIComponent(query)}`;
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('Network response was not ok');
                const movies = await response.json();
                loader.style.display = 'none';
                return movies;
            } catch (error) {
                console.error('Failed to fetch movies:', error);
                loader.style.display = 'none';
                noResults.innerText = "Error: Could not connect to the backend server.";
                noResults.style.display = 'block';
                return [];
            }
        };
        
        const renderMovies = (movies) => {
            movieGrid.innerHTML = '';
            if (movies.length === 0) {
                noResults.style.display = 'block';
                movieGrid.style.display = 'none';
            } else {
                noResults.style.display = 'none';
                movieGrid.style.display = 'grid';
                movies.forEach(movie => {
                    const movieCard = document.createElement('div');
                    movieCard.className = 'movie-card rounded-lg overflow-hidden shadow-lg cursor-pointer';
                    movieCard.innerHTML = `
                        <div class="relative">
                            <img src="${movie.posterUrl}" alt="${movie.title}" class="w-full h-full object-cover">
                            <div class="absolute inset-0 movie-details p-4 flex flex-col justify-end">
                                <h3 class="text-white font-bold text-lg">${movie.title}</h3>
                                <div class="flex items-center text-yellow-400 mt-1">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                    <span class="ml-1 font-semibold">${movie.imdbRating}</span>
                                </div>
                            </div>
                        </div>`;
                    movieCard.addEventListener('click', () => openModal(movie));
                    movieGrid.appendChild(movieCard);
                });
            }
        };

        const openModal = (movie) => {
            modalContent.innerHTML = `
                <div class="w-full md:w-1/3 flex-shrink-0">
                    <img src="${movie.posterUrl}" alt="${movie.title}" class="w-full h-full object-cover">
                </div>
                <div class="w-full md:w-2/3 p-6 flex flex-col justify-between">
                    <div>
                        <button id="close-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors text-3xl font-bold">&times;</button>
                        <h2 class="text-3xl font-bold text-white mb-2">${movie.title} (${movie.releaseYear})</h2>
                        <div class="flex flex-wrap gap-2 mb-4">${movie.genres.map(g => `<span class="bg-purple-600 text-white text-xs font-semibold px-2.5 py-1 rounded-full">${g}</span>`).join('')}</div>
                        <p class="text-gray-300 mb-4">${movie.plot}</p>
                        <div><h4 class="font-semibold text-white mb-2">Star Cast</h4><p class="text-gray-400">${movie.starCast.join(', ')}</p></div>
                    </div>
                </div>`;
            modal.style.display = 'flex';
            document.getElementById('close-modal').addEventListener('click', closeModal);
        };
        
        const closeModal = () => modal.style.display = 'none';

        searchInput.addEventListener('input', async (e) => {
            const query = e.target.value;
            gridTitle.textContent = query ? `Search Results for "${query}"` : 'Top Rated Movies';
            const movies = await fetchMovies(query);
            renderMovies(movies);
        });
        
        modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

        window.addEventListener('load', async () => {
            const movies = await fetchMovies();
            renderMovies(movies);
        });
    </script>
</body>
</html>